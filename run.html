<!doctype html><html lang="en"><head>
  <meta charset="utf-8"/><title>Nepsis A/B Demo Runner</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="/styles.css"/>
  <style>
  :root{
    --bg:#0b1220;
    --card:#0f172a;
    --ink:#e6edf6;
    --muted:#9fb0c9;
    --line:#1f2937;
    --accent:#67e8f9;
    --accent-2:#c084fc;
    --ok:#10b981;
    --bad:#ef4444;
  }
  html,body{height:100%}
  body{
    margin:0;color:var(--ink);background:
      radial-gradient(1200px 600px at 10% -10%,rgba(103,232,249,.12),transparent 60%),
      radial-gradient(1000px 500px at 90% -20%,rgba(192,132,252,.10),transparent 60%),
      var(--bg);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }
  main{max-width:1100px;margin:3rem auto;padding:0 1rem}
  h1{font-size:2rem;margin:.25rem 0 1rem;background:linear-gradient(90deg,var(--accent),var(--accent-2));-webkit-background-clip:text;background-clip:text;color:transparent}
  p{color:var(--muted)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
  .card{background:var(--card);border:1px solid var(--line);border-radius:.9rem;padding:1rem}
  .cta-section{margin-top:3rem;padding:1.5rem;border:1px solid var(--line);border-radius:1rem;background:var(--card)}
  .cta-title{margin:0 0 .5rem;font-size:1.5rem}
  .cta-text{margin:0 0 1rem;color:var(--muted)}
  .cta-button{appearance:none;border:0;border-radius:.8rem;padding:.65rem 1.2rem;background:linear-gradient(90deg,rgba(103,232,249,.35),rgba(192,132,252,.35));color:var(--ink);cursor:pointer;font-weight:600;transition:transform .05s ease,opacity .2s}
  .cta-button.active{box-shadow:0 0 0 2px rgba(103,232,249,.6) inset}
  .cta-button:disabled{opacity:.6;cursor:not-allowed}
  .toggle-group{display:inline-flex;border:1px solid var(--line);border-radius:.75rem;overflow:hidden}
  .toggle-group button{background:transparent;color:var(--ink);padding:.45rem .9rem;border:0;cursor:pointer;font-weight:600;transition:background .2s,color .2s}
  .toggle-group button.active{outline:2px solid var(--accent);box-shadow:0 0 0 3px color-mix(in oklab, var(--accent) 25%, transparent);font-weight:600;background:rgba(103,232,249,.18)}
  .toggle-label{font-size:.85rem;color:var(--muted);margin-right:.5rem}
  .chip{display:inline-flex;align-items:center;gap:.35rem;padding:.2rem .5rem;border:1px solid var(--muted);border-radius:999px;font-size:.75rem;color:var(--muted)}
  .metrics-table{width:100%;border-collapse:collapse}
  .metrics-table th,.metrics-table td{border-bottom:1px solid var(--line);padding:.55rem;text-align:left}
  .code-block{background:#0b1220;border:1px solid var(--line);border-radius:.7rem;padding:1rem;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;color:var(--ink)}
  .toolbar{position:sticky;top:0;z-index:10;background:var(--bg);border-bottom:1px solid var(--muted);padding:.6rem .8rem}
  .controls-row{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center}
  .ctrl-label{font-size:.85rem;color:var(--muted)}
  .ctrl{padding:.35rem .5rem;border:1px solid var(--muted);border-radius:.5rem;background:transparent;color:inherit}
  .btn{appearance:none;border-radius:.65rem;border:1px solid var(--muted);padding:.45rem .9rem;background:transparent;color:var(--ink);font-weight:600;cursor:pointer;transition:background .2s,color .2s,transform .05s}
  .btn:hover{background:rgba(103,232,249,.12)}
  .btn.active{border-color:var(--accent);color:var(--accent);background:rgba(103,232,249,.14)}
  .btn.primary{background:linear-gradient(90deg,rgba(103,232,249,.35),rgba(192,132,252,.35));border:0}
  .btn.ghost{background:transparent;color:var(--muted)}
  .pill{font-size:.78rem;padding:.2rem .5rem;border:1px solid var(--muted);border-radius:999px;color:var(--muted)}
  .samples{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center;margin:.5rem 0 1rem}
  .samples-label{font-size:.85rem;color:var(--muted);margin-right:.25rem}
  .chip{display:inline-flex;align-items:center;gap:.35rem;padding:.2rem .5rem;border:1px solid var(--muted);border-radius:999px;font-size:.75rem;color:var(--muted);cursor:pointer;transition:background .2s,color .2s}
  .chip-naked{border-color:#b45309;color:#b45309}
  .chip-naked-alt{background:#fff7ed;border-color:#fed7aa;color:#9a3412}
  .chip-nepsis{border-color:#2563eb;color:#2563eb}
  .chip-nepsis-alt{background:#eff6ff;border-color:#bfdbfe;color:#1d4ed8}
  .whitespace-nowrap{white-space:nowrap}
  textarea{width:100%;padding:.7rem .8rem;border:1px solid var(--line);border-radius:.7rem;background:#0b1220;color:var(--ink);resize:vertical;min-height:70px;font-family:ui-monospace,SFMono-Regular,Menlo,monospace}
  textarea::placeholder{opacity:.45;color:var(--muted)}
  textarea:focus::placeholder{opacity:.2}
  label{display:block;color:var(--muted);font-size:.9rem;margin:.25rem 0 .35rem}
  .card label:first-of-type{margin-top:0}
  table{width:100%;border-collapse:collapse;color:var(--ink)}
  th,td{border-bottom:1px solid var(--line);padding:.6rem;text-align:left}
  .ok{color:var(--ok)}.bad{color:var(--bad)}
  .back{margin-left:auto;color:var(--accent);text-decoration:none}
  .pulse{box-shadow:0 0 0 6px rgba(103,232,249,.15);transition:box-shadow .35s ease}
  #toast{position:fixed;right:18px;bottom:18px;background:var(--card);border:1px solid var(--line);color:var(--ink);padding:.55rem .8rem;border-radius:.6rem;opacity:0;transform:translateY(8px);transition:opacity .15s ease,transform .15s ease;pointer-events:none}
  #toast.show{opacity:1;transform:none}
  </style>
</head><body><main>
  <h1>Nepsis A/B Demo Runner</h1>
  <p>Use your own LLM. Copy the prompts, run them, paste outputs below, then <em>Evaluate</em>.</p>
  <div class="toolbar">
    <div class="controls-row">
      <!-- Model selector (tracking-only for now) -->
      <label class="ctrl-label" for="modelSelect">Model</label>
      <select id="modelSelect" class="ctrl">
        <option>GPT-5</option>
        <option>Claude 3.7 Sonnet</option>
        <option>o3</option>
        <option>Llama 3.1 405B</option>
        <option>Gemini 2.0 Pro</option>
        <option value="custom">Custom…</option>
      </select>
      <span id="modelBadge" class="pill"></span>

      <!-- Prompts (copy only) -->
      <button id="btnCopyNaked" class="btn" type="button">Copy Naked Prompt</button>
      <button id="btnCopyScaffold" class="btn" type="button">Copy Nepsis-Scaffold Prompt</button>

      <!-- Evaluate -->
      <button id="btnEvaluate" class="btn primary" type="button">Evaluate Pasted Outputs</button>

      <!-- Export -->
      <button id="btnDownloadCsv" class="btn ghost" type="button">Download Scorecard CSV</button>

      <span id="promptToast" style="display:none;color:var(--muted)">Prompt copied</span>
    </div>
  </div>
  <a href="/" class="back" style="margin-left:auto;display:inline-block;margin-top:.6rem">← Back</a>
  <!-- ===== A/B Runner & Evaluator ===== -->
  <section id="runner" class="cta-section" style="margin-top:60px">
    <h2 class="cta-title">Try It Yourself — No Install</h2>
    <p class="cta-text">
      Copy a prompt or paste your class below, then click <b>Run Tests</b> or evaluate saved outputs.
    </p>
    <details style="margin:0 0 1rem 0;color:var(--muted);font-size:.85rem">
      <summary style="cursor:pointer;color:var(--accent)">How to use (quick)</summary>
      <ul style="margin:.6rem 0 0 1.1rem;padding:0;list-style:disc">
        <li>Copy Naked or Scaffold Lite, paste into your LLM, and grab the class.</li>
        <li>Paste code in the editor, or paste model outputs in the output tab.</li>
        <li>Press <kbd>⌘/Ctrl</kbd> + <kbd>Enter</kbd> to evaluate instantly.</li>
      </ul>
    </details>
    <div class="samples">
      <span class="samples-label">Samples:</span>
      <button id="btnCopyNakedSample" class="chip chip-naked" type="button">Copy Naked (8/11)</button>
      <button id="btnInsertNakedSample" class="chip chip-naked-alt" type="button">Insert → Code Editor</button>
      <button id="btnCopyNepsisSample" class="chip chip-nepsis" type="button">Copy Nepsis Lite (11/11)</button>
      <button id="btnInsertNepsisSample" class="chip chip-nepsis-alt" type="button">Insert → Code Editor</button>
    </div>
    <div class="toolbar" style="gap:1rem;margin:0 0 1.2rem 0">
      <span class="toggle-label">Difficulty</span>
      <div class="toggle-group" id="difficultyToggle">
        <button type="button" data-difficulty="standard" class="active">Standard</button>
        <button type="button" data-difficulty="hard">Hard</button>
      </div>
      <span class="chip" id="consistencyChip">Consistency check: k=3 • seeds 137 / 991 / 2401</span>
    </div>
    <div style="display:flex;gap:10px;margin:10px 0">
      <button id="tabCode" class="cta-button" type="button">I have code</button>
      <button id="tabOutput" class="cta-button" type="button" style="background:transparent;border:1px solid var(--line);">I only have output</button>
    </div>

    <div id="codePane">
      <textarea id="solutionCode" spellcheck="false"
        style="width:100%;min-height:260px;border-radius:12px;padding:14px;background:#0d1117;color:#e6edf3;border:1px solid #30363d;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;">
# Paste ONLY the class Utf8StreamNormalizer below (no tests). Example stub:
import unicodedata
class Utf8StreamNormalizer:
    def __init__(self):
        self.errors = []
    def push(self, chunk: bytes) -> str:
        return ""
    def finish(self) -> str:
        return ""
      </textarea>

      <div style="margin:14px 0;display:flex;gap:12px;flex-wrap:wrap">
        <button id="runBtn" class="cta-button">Run Tests →</button>
        <span id="loader" style="display:none;color:var(--muted)">Loading Python…</span>
      </div>

      <div id="resultsWrap" style="margin-top:12px">
        <div id="headline" style="font-weight:700;margin-bottom:8px"></div>
        <div id="tableOutput"></div>
        <pre id="rawOutput" class="code-block" style="display:none;white-space:pre-wrap"></pre>
      </div>
    </div>

    <div id="outputPane" style="display:none;margin-top:10px">
      <p class="cta-text" style="margin-bottom:6px">
        Paste the <b>printed characters</b> (not code) from your model run.
        We probe for: <code>é</code>, <code>é</code>, <code>한</code> and reject any <code>�</code>.
      </p>
      <div style="display:grid;gap:10px;grid-template-columns:1fr 1fr">
      <div>
          <div style="color:var(--muted);margin-bottom:6px">Naked Output</div>
          <textarea id="nakedOut" spellcheck="false" placeholder="Paste Naked output here, then press ⌘/Ctrl+Enter…" style="width:100%;min-height:120px;border-radius:12px;padding:12px;background:#0d1117;color:#e6edf3;border:1px solid #30363d;"></textarea>
      </div>
      <div>
          <div style="color:var(--muted);margin-bottom:6px">Nepsis-Scaffold Output</div>
          <textarea id="nepsisOut" spellcheck="false" placeholder="Paste Nepsis Lite output here…" style="width:100%;min-height:120px;border-radius:12px;padding:12px;background:#0d1117;color:#e6edf3;border:1px solid #30363d;"></textarea>
      </div>
      </div>
      <div id="evalTables" style="margin-top:12px"></div>
    </div>
  </section>

  <section id="metricsCard" class="card metrics-card">
    <h3 style="margin-top:0">Metrics Summary <span class="chip">k=3 consistency</span></h3>
    <p style="margin:0 0 .75rem;color:var(--muted);font-size:.85rem">Standard: Canonical first run 11/11. Variability is normal; Hard Mode is adversarial and enforces strict span/structure checks.</p>
    <table id="metricsTable" class="metrics-table">
      <thead>
        <tr><th>Model</th><th>Prompt</th><th>Difficulty</th><th>Runs</th><th>Pass %</th><th>Passed / Total</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <section id="historyCard" class="card metrics-card">
    <h3 style="margin-top:0">Recent Runs</h3>
    <table id="runsTable" class="metrics-table">
      <thead>
        <tr><th>Timestamp</th><th>Model</th><th>Prompt</th><th>Difficulty</th><th>Passed</th><th>Total</th><th>Pass %</th><th>Run ID</th><th>Tags</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>
  <footer style="margin-top:2rem;color:var(--muted);font-size:0.9rem">
    This is MVP Nepsis in scaffold form. This work is proprietary. For discussion or consultation, please email:
    <a href="mailto:ttranslucent@gmail.com" style="color:var(--accent);text-decoration:none">ttranslucent@gmail.com</a>.
  </footer>
</main><div id="toast" aria-live="polite"></div><script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script><script src="/runner.js"></script></body></html>
